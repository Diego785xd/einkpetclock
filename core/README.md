here goes the spi logic